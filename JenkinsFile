pipeline {
    agent any

    stages {
        stage('Checkout') {
            steps {
                git 'https://github.com/sarapap/TimeCalculator.git'
            }
        }

        stage('Build') {
            steps {
                withEnv(["PATH+EXTRA=/usr/local/opt/maven/bin:/bin:/usr/bin"]) {
                    sh 'mvn clean install'
                }
            }
        }

        stage('Test') {
            steps {
                withEnv(["PATH+EXTRA=/usr/local/opt/maven/bin:/bin:/usr/bin"]) {
                    sh 'mvn test'
                }
            }
        }

        stage('Code Coverage') {
            steps {
                jacoco execPattern: '**/target/jacoco.exec'
            }
        }
    }

    post {
        always {
            // Ensure this path matches where the test reports are actually generated
            junit '**/target/surefire-reports/*.xml'
            // Ensure this path matches where the JaCoCo reports are actually located
            jacoco execPattern: '**/target/jacoco.exec'
        }
    }
}
